# Local Machine Learning: Extra Decision Trees

The algorithm that Azure Machine Learning decided was the best performing for this dataset was Extra Random Trees (Extra Trees for short). The Extra Trees algorithm builds multiple decision trees and splits nodes on those trees using random subsets of features.

## Train Model

Import the `ExtraTreesClassifier` algorithm from `sklearn.ensemble` and build and fit a model with it and make predictions on the test data. (You can go ahead and re-use the same `X` and `y` from the previous module.)

```python
from sklearn.ensemble import ExtraTreesClassifier

exrt = ExtraTreesClassifier()
exrt.fit(X, y)

pred_y = exrt.predict(test_X)
pred_y
```

```output
array([1, 1, 1, 0, 1], dtype=int64)
```

## Predict Delays

The Extra Tree algorithm picked the delayed launch due to heavy thunderstorms but missed the launch delayed by hurricane-force winds. Let's look at the actual probabilities generated by the algorithm.

```python
eprobs = exrt.predict_proba(test_X)
eprobs
```

```output
array([[0.04, 0.96],
       [0.  , 1.  ],
       [0.04, 0.96],
       [0.5 , 0.5 ],
       [0.24, 0.76]])
```

This is intriguing, but still a little hard to read. Let's look at it in a more readable format.

```python
for i in range(len(test_df.index)):
    print(test_df.index[i] + ' probability of delay is {:.2%}'.format(eprobs[i][0]))
```

```output
Test 1 probability of delay is 4.00%
Test 2 probability of delay is 0.00%
Test 3 probability of delay is 4.00%
Test 4 probability of delay is 50.00%
Test 5 probability of delay is 24.00%
```

Interestingly, while Extra Trees correctly flagged the launched delayed by heavy thunderstorms, it completely missed the delay due to high winds. Let's examine why.

One advantage of Extra Trees over k-NN is that we can see which features the model ranked as most important. We can do this via the `feature_importances_` attribute of the model object. (It's also advisable to put the output of the method in a data structure like a pandas Series in order to make is easier to read.)

```python
pd.Series(exrt.feature_importances_, index=df.iloc[:, :-1].columns)
```

```output
Day of Year     0.03
Time            0.01
Temp            0.02
Percipitation   0.11
Wind Speed      0.15
Visibility      0.01
Day Length      0.06
Cloudy          0.03
Fair            0.01
Heavy T-Storm   0.54
Partly Cloudy   0.01
Rain            0.01
dtype: float64
```

Wind and thunderstorms carried the most weight in this model, so it is additionally surprising that it classified the launch delayed by high winds with such a high probability for launch. However, the Extra Trees model did generate better precision and accuracy than k-NN. (Note that because we are scoring this based on a test set with only five records, the precision and accuracy scores will not be very granular.)

```python
print('Extra-trees precision: {}'.format(sklearn.metrics.precision_score(true_y, pred_y)))
print('Extra-trees accuracy: {}'.format(sklearn.metrics.accuracy_score(true_y, pred_y)))
```

```output
Extra-trees precision: 0.75
Extra-trees accuracy: 0.8
```